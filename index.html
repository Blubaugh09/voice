<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bible Voice Recognition</title>
  <style>
    #status {
      margin-top: 20px;
      font-size: 18px;
      color: blue;
    }
    #output {
      margin-top: 20px;
      font-size: 16px;
    }
    .listening {
      color: red;
      font-weight: bold;
    }
    #micIcon {
      display: none;
      font-size: 30px;
      color: red;
    }
    .checkmark {
      display: inline-block;
      color: green;
      margin-left: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Bible Voice Recognition</h1>

  <button id="startBtn">Start Listening</button>
  <p id="status">Click the button to start and say a Bible reference like "Genesis chapter 1 verse 23".</p>
  <div id="micIcon">üé§</div>

  <div id="output">
    <div>Book: <span id="book"></span> <span id="bookCheck" class="checkmark">‚úîÔ∏è</span></div>
    <div>Chapter: <span id="chapter"></span> <span id="chapterCheck" class="checkmark">‚úîÔ∏è</span></div>
    <div>Verse: <span id="verse"></span> <span id="verseCheck" class="checkmark">‚úîÔ∏è</span></div>
  </div>
  <p id="log"></p>

  <script>
    const startBtn = document.getElementById('startBtn');
    const micIcon = document.getElementById('micIcon');
    const output = document.getElementById('output');
    const status = document.getElementById('status');
    const log = document.getElementById('log');
    const bookElement = document.getElementById('book');
    const chapterElement = document.getElementById('chapter');
    const verseElement = document.getElementById('verse');
    const bookCheck = document.getElementById('bookCheck');
    const chapterCheck = document.getElementById('chapterCheck');
    const verseCheck = document.getElementById('verseCheck');

    // Initially hide checkmarks
    bookCheck.style.display = 'none';
    chapterCheck.style.display = 'none';
    verseCheck.style.display = 'none';

    // Number words mapping
    const numberWords = {
      "one": 1, "two": 2, "three": 3, "four": 4, "five": 5,
      "six": 6, "seven": 7, "eight": 8, "nine": 9, "ten": 10,
      "eleven": 11, "twelve": 12, "thirteen": 13, "fourteen": 14, 
      "fifteen": 15, "sixteen": 16, "seventeen": 17, "eighteen": 18, 
      "nineteen": 19, "twenty": 20, "thirty": 30, "forty": 40, "fifty": 50, 
      "sixty": 60, "seventy": 70, "eighty": 80, "ninety": 90
    };

    // Helper function to convert number words to digits
    function convertNumberWordsToDigits(input) {
      return input.replace(/\bone\b/g, '1') // Direct replacement for "one"
        .replace(/\b(two|three|four|five|six|seven|eight|nine|ten|eleven|twelve|thirteen|fourteen|fifteen|sixteen|seventeen|eighteen|nineteen|twenty|thirty|forty|fifty|sixty|seventy|eighty|ninety)\b/g, match => numberWords[match]);
    }

    // Check if browser supports speech recognition
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = 'en-US';

    // Enable continuous recognition and restart after each result
    recognition.continuous = true;
    recognition.interimResults = false;

    // Show mic icon when recording
    recognition.onstart = () => {
      micIcon.style.display = 'block';
      status.textContent = "Listening... please say a Bible reference.";
      status.classList.add('listening');
    };

    // Hide mic icon when recording stops
    recognition.onspeechend = () => {
      micIcon.style.display = 'none';
      status.textContent = "Processing speech...";
      status.classList.remove('listening');
    };

    // Process the speech result
    recognition.onresult = (event) => {
      let transcript = event.results[event.results.length - 1][0].transcript.toLowerCase();
      log.textContent = `Recognized speech: "${transcript}"`;

      // Convert number words to digits
      transcript = convertNumberWordsToDigits(transcript);
      console.log('Recognized text after conversion:', transcript);

      // Regex pattern to capture both "book X verse Y" and "book chapter X verse Y"
      const bibleRegex = /(genesis|exodus|leviticus|numbers|deuteronomy|joshua|judges|ruth|1 samuel|2 samuel|1 kings|2 kings|1 chronicles|2 chronicles|ezra|nehemiah|esther|job|psalms|proverbs|ecclesiastes|song of solomon|isaiah|jeremiah|lamentations|ezekiel|daniel|hosea|joel|amos|obadiah|jonah|micah|nahum|habakkuk|zephaniah|haggai|zechariah|malachi|matthew|mark|luke|john|acts|romans|1 corinthians|2 corinthians|galatians|ephesians|philippians|colossians|1 thessalonians|2 thessalonians|1 timothy|2 timothy|titus|philemon|hebrews|james|1 peter|2 peter|1 john|2 john|3 john|jude|revelation)\s(?:chapter\s)?(\d+)\sverse\s(\d+)/;

      const match = transcript.match(bibleRegex);

      if (match) {
        const book = match[1];
        const chapter = match[2];
        const verse = match[3];
        
        // Update the UI with the confirmed book, chapter, and verse
        bookElement.textContent = book;
        chapterElement.textContent = chapter;
        verseElement.textContent = verse;

        // Show checkmarks for confirmation
        bookCheck.style.display = 'inline-block';
        chapterCheck.style.display = 'inline-block';
        verseCheck.style.display = 'inline-block';

        // Log book, chapter, and verse to the console
        console.log(`Book: ${book}, Chapter: ${chapter}, Verse: ${verse}`);
        log.textContent += " - Successfully matched Bible reference!";
      } else {
        log.textContent += " - No match found. Please try again.";
      }
    };

    // Handle errors during recognition
    recognition.onerror = (event) => {
      status.textContent = "Error occurred during recognition.";
      log.textContent = `Error: ${event.error}`;
    };

    // Start speech recognition when button is clicked
    startBtn.addEventListener('click', () => {
      recognition.start();
      log.textContent = 'Listening continuously for Bible references...';
    });

    // Restart recognition after each speech result
    recognition.onend = () => {
      recognition.start(); // Automatically restart listening
    };

  </script>
</body>
</html>
